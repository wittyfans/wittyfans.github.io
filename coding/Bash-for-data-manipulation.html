<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="bash,linux," />





  <link rel="alternate" href="/atom.xml" title="Scott Zhang" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Bash is a Unix shell and command language, it survived and thrived for almost 50 years because it lets people do complex things with just a few keystrokes. Sometimes called “the universal glue of pro">
<meta name="keywords" content="bash,linux">
<meta property="og:type" content="article">
<meta property="og:title" content="Bash for data manipulation">
<meta property="og:url" content="http://wittyfans.com/coding/Bash-for-data-manipulation.html">
<meta property="og:site_name" content="Scott Zhang">
<meta property="og:description" content="Bash is a Unix shell and command language, it survived and thrived for almost 50 years because it lets people do complex things with just a few keystrokes. Sometimes called “the universal glue of pro">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2021-02-25T15:30:29.977Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Bash for data manipulation">
<meta name="twitter:description" content="Bash is a Unix shell and command language, it survived and thrived for almost 50 years because it lets people do complex things with just a few keystrokes. Sometimes called “the universal glue of pro">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://wittyfans.com/coding/Bash-for-data-manipulation.html"/>





  <title> Bash for data manipulation | Scott Zhang </title>
  <script type="text/javascript" src="/js/src/love.js"></script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Scott Zhang</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">学则不固,知则不惑</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://wittyfans.com/coding/Bash-for-data-manipulation.html">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Scott Zhang">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Scott Zhang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Scott Zhang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Bash for data manipulation
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-02-25T23:20:39+08:00">
                2021-02-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/coding/" itemprop="url" rel="index">
                    <span itemprop="name">coding</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          
             <span id="/coding/Bash-for-data-manipulation.html" class="leancloud_visitors" data-flag-title="Bash for data manipulation">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
               <span>℃</span>
              </span>
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>Bash is a Unix shell and command language, it survived and thrived for almost 50 years because it lets people do complex things with just a few keystrokes. Sometimes called “the universal glue of programming,” it helps users combine existing programs in new ways, automate repetitive tasks, and run programs on clusters and clouds that may be halfway around the world. </p>
</blockquote>
<a id="more"></a>
<h1 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h1><blockquote>
<p>How to move around in the shell, and how to create, modify, and delete files and folders.</p>
</blockquote>
<ul>
<li><code>pwd</code> print working directory</li>
<li><code>ls</code>: listing files or directories</li>
<li><code>cd</code>: change directory</li>
<li><code>cp</code>: copy</li>
<li><code>mv</code>: move or rename</li>
<li><code>rm</code>: remove</li>
<li><code>$1</code> or <code>$2</code> in bash script file, receive ARGV in bash scripts. <code>$@</code> , <code>$*</code> means get ARGV list, <code>$#</code> means get ARGV length.</li>
</ul>
<h1 id="Find-files"><a href="#Find-files" class="headerlink" title="Find files"></a>Find files</h1><h2 id="by-name"><a href="#by-name" class="headerlink" title="by name"></a>by name</h2><ul>
<li>find ., list all file and folder below current</li>
<li>find folder</li>
<li>find . -type d, find all foldre, no file</li>
<li>find . -type f, find all file , no foldre</li>
<li>find . -type f -name “test.txt”, name as text txt file</li>
<li>find . -type f -name “text*”, name as txt all file</li>
<li>find . -type f -iname “text*”, 不区分大小写</li>
<li>find . -type f -name “*.py”</li>
</ul>
<h2 id="by-time"><a href="#by-time" class="headerlink" title="by time"></a>by time</h2><ul>
<li>find . -type f -mmin -10,过去十分钟修改过的文件</li>
<li>find . -type f -mmin +10</li>
<li>find . -type f -mmin +1 -mmin -5</li>
<li>find . -type f -mtime -20</li>
</ul>
<p>amin,atime: access min and access day; cmin,ctime: change min and change day; mmin,mtime: modify;</p>
<h2 id="by-size"><a href="#by-size" class="headerlink" title="by size"></a>by size</h2><ul>
<li><p>find . -size +5m, k,g is work too</p>
</li>
<li><p>ls -lah ./folders, info about sub folder and files,including size</p>
</li>
<li>find . -empty</li>
</ul>
<h2 id="by-permission"><a href="#by-permission" class="headerlink" title="by permission"></a>by permission</h2><ul>
<li>find. -perm 777, read, write, and excute</li>
<li>find folder -exec chown coreschafer:www-data {} +</li>
</ul>
<p>find folder, will return all folder, -exec will run the command in that results, {} palceholder, + end of the command.</p>
<ul>
<li>find folder -type f -exec chmod 664 {} +</li>
<li>find folder -perm 664</li>
<li>find . -type f -name “*.jpg”</li>
<li>find . -type f -name “*.jpg” -maxdepth 1, searched 1 level down</li>
<li>find . -type f -name “*.jpg” -maxdepth 1 -exec rm {} +, delete serched files</li>
</ul>
<h1 id="Grep"><a href="#Grep" class="headerlink" title="Grep"></a>Grep</h1><h2 id="Grep-single-file"><a href="#Grep-single-file" class="headerlink" title="Grep single file"></a>Grep single file</h2><blockquote>
<p>searched text</p>
</blockquote>
<ul>
<li>grep “text_you_want_search” filename.txt</li>
<li>grep -w “text_you_want_search” filename.txt, have to match all words</li>
<li>grep -wi “text_you_want_search” filename.txt, igore the lowcase and uppearcse.</li>
<li>grep -win “text_you_want_search” filename.txt, get info about the line number</li>
<li>grep -win -B 4 “text_you_want_search” filename.txt, return the context about the searched words, 4 line, behind</li>
<li>grep -win -A 4 “text_you_want_search” filename.txt, return the context about the searched words, 4 line, ahead</li>
<li>grep -win -C 4 “text_you_want_search” filename.txt, return the context about the searched words, 4 line, two line before and two behind.</li>
</ul>
<h2 id="Grep-multi-file"><a href="#Grep-multi-file" class="headerlink" title="Grep multi file"></a>Grep multi file</h2><ul>
<li>grep -win “text_” ./*, all file</li>
<li>grep -win “text_” ./*.txt, txt file</li>
<li>grep -winr “text” ./ , search all subdir</li>
<li>grep -wirl “text” ./ , no need match info, just file list</li>
<li>grep -wirc “text” ./ , show matched number in eatch file</li>
</ul>
<h2 id="Grep-command-history"><a href="#Grep-command-history" class="headerlink" title="Grep command history"></a>Grep command history</h2><ul>
<li>history | grep “git commit”</li>
<li>history | grep “git commit” | grep “dotfile”</li>
</ul>
<h2 id="Grep-rgx"><a href="#Grep-rgx" class="headerlink" title="Grep rgx"></a>Grep rgx</h2><ul>
<li>grep -P “\d{3}-\d{3}-\d{4}” file.txt, work well in linux, mac need to config, I configed</li>
</ul>
<h1 id="cURL"><a href="#cURL" class="headerlink" title="cURL"></a>cURL</h1><h2 id="Requests"><a href="#Requests" class="headerlink" title="Requests"></a>Requests</h2><ul>
<li>curl url</li>
<li>curl <a href="http://localhost:5000" target="_blank" rel="noopener">http://localhost:5000</a></li>
<li>curl http:<a href="http://www.wittyfans.com/json_file" target="_blank" rel="noopener">www.wittyfans.com/json_file</a><ul>
<li>curl -i http:<a href="http://www.wittyfans.com/json_file" target="_blank" rel="noopener">www.wittyfans.com/json_file</a>, details info about the get</li>
</ul>
</li>
<li>curl http:<a href="http://www.wittyfans.com/method" target="_blank" rel="noopener">www.wittyfans.com/method</a><ul>
<li>curl -d “first=name&amp;last=lastname” http:<a href="http://www.wittyfans.com/method" target="_blank" rel="noopener">www.wittyfans.com/method</a>, d for data, Post request</li>
<li>curl -X PUT -d “first=name&amp;last=lastname” http:<a href="http://www.wittyfans.com/method" target="_blank" rel="noopener">www.wittyfans.com/method</a>, d for data, Pust request</li>
<li>curl -X DELETE http:<a href="http://www.wittyfans.com/method" target="_blank" rel="noopener">www.wittyfans.com/method</a>, delete request</li>
</ul>
</li>
</ul>
<h2 id="Verify"><a href="#Verify" class="headerlink" title="Verify"></a>Verify</h2><blockquote>
<p>could not verify your access ?</p>
</blockquote>
<ul>
<li>curl -u username:password <a href="http://wittyfans.com">http://wittyfans.com</a>, Auth</li>
</ul>
<h2 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h2><blockquote>
<p>Download file</p>
</blockquote>
<ul>
<li>curl <a href="http://wittyfans.com/folder">http://wittyfans.com/folder</a>, return binary file , error</li>
<li>curl -o filename.jpg <a href="http://wittyfans.com/folder">http://wittyfans.com/folder</a>, sucess</li>
</ul>
<blockquote>
<p>Saving large json file</p>
</blockquote>
<ul>
<li>curl -o file_name.json http:/.api.wittyfans.com</li>
</ul>
<h1 id="rsync"><a href="#rsync" class="headerlink" title="rsync"></a>rsync</h1><h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><blockquote>
<p>aviable in Mac, debian-based linux need to install</p>
</blockquote>
<ul>
<li>apt-get install rsync</li>
<li>yum install rsync</li>
</ul>
<h2 id="Use"><a href="#Use" class="headerlink" title="Use"></a>Use</h2><ul>
<li>rsync folder1/* backup/ , sync fils to backup folder,will skping the subfolder’s file, but affected subfolder</li>
<li>rsync -r folder1/* backup/ , including subfolder’s file</li>
<li>rsync -r folder1 backup/, sync folder, not content in it</li>
</ul>
<h2 id="Check-chage-before-run"><a href="#Check-chage-before-run" class="headerlink" title="Check chage before run"></a>Check chage before run</h2><ul>
<li>rsync -a –dry-run folder1/* backup/, check before the command run, now view showed<ul>
<li>rsync -av –dry-run folder1/* backup/, auto view</li>
</ul>
</li>
</ul>
<h2 id="Source-folder-has-new-file"><a href="#Source-folder-has-new-file" class="headerlink" title="Source_folder has new file"></a>Source_folder has new file</h2><ul>
<li>rsync -av –delete –dry-run original/ backup/, check, be careful !</li>
</ul>
<h2 id="Do-it-in-local-and-host"><a href="#Do-it-in-local-and-host" class="headerlink" title="Do it in local and host"></a>Do it in local and host</h2><ul>
<li>rsync -zaP -p local_folder username@ip:~/public/, z for compress, a for all, P for tarnsfer in internet</li>
<li>rsync 0zaP username@ip:~/public/file ~/Downloads/, revers</li>
</ul>
<h1 id="Manipulating-data"><a href="#Manipulating-data" class="headerlink" title="Manipulating data"></a>Manipulating data</h1><blockquote>
<p>How to work with the data in those files</p>
</blockquote>
<p><code>cat</code>: view a files contents, meaning concatenate</p>
<p><code>less</code> &amp; <code>more</code>: view contents piece by piece, <code>more</code> is superseded by <code>less</code> now, In <code>less</code>:</p>
<ul>
<li><code>:n</code>, Move to next file</li>
<li><code>:p</code>, Go back to previous file</li>
<li><code>:q</code>, quit</li>
</ul>
<p><code>head</code>: look at the start of a text file, <code>head -3</code>, only display the first three lines</p>
<p><code>tail</code>: look at the end of a text file, <code>tail -n +7</code>, display content from line 7 to end</p>
<p><code>ls</code> : list everything below a directory, <code>ls -R -F</code>, <code>-R</code> recursive <code>-F</code>prints a <code>/</code> after the name of every directory and a <code>*</code> after the name of every runnable program. </p>
<p><code>man</code>: manual, automatically  invokes <code>less</code></p>
<p><code>cut -f 2-5,8 -d values.csv</code>: select columns 2 through 5 and columns 8, using comma as the separator. <code>-d</code> means delimiter, <code>-f</code> meaning fields to specify columns</p>
<p><code>!command</code>: re-run the most recent use of that command matched</p>
<p><code>grep bicuspid seasonal/winter.csv</code>: prints lines from winter.csv that contain “bicuspid”</p>
<p><code>cat two_cities.txt | egrep &#39;Sydney Carton|Charles Darnay&#39; | wc -l</code> : Count the number of lines in the book that contain <em>either</em> the character ‘Sydney Carton’ or ‘Charles Darnay’.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-c: <span class="built_in">print</span> a count of matching lines rather than the lines themselves</span><br><span class="line">-h: <span class="keyword">do</span> not <span class="built_in">print</span> the names of files when searching multiple files</span><br><span class="line">-i: ignore <span class="keyword">case</span> (e.g., treat <span class="string">"Regression"</span> and <span class="string">"regression"</span> as matches)</span><br><span class="line">-l: <span class="built_in">print</span> the names of files that contain matches, not the matches</span><br><span class="line">-n: <span class="built_in">print</span> line numbers <span class="keyword">for</span> matching lines</span><br><span class="line">-v: invert the match, i.e., only show lines that don<span class="string">'t match</span></span><br><span class="line"><span class="string">egrep: grep -E</span></span><br></pre></td></tr></table></figure>
<h2 id="Combining-tools"><a href="#Combining-tools" class="headerlink" title="Combining tools"></a>Combining tools</h2><blockquote>
<p>How to use this power to select the data you want, and introduce commands for sorting values and removing duplicates.</p>
</blockquote>
<p><code>head -n 5 seasonal/summer.csv &gt; top.csv</code>:  get first 5 rows content of summer.csv, write to top.csv</p>
<p><code>cut -d , -f 2 seasonal/summer.csv | grep -v Tooth</code>,  select all of the tooth names from column 2 of the comma delimited file.</p>
<p><code>wc</code>, word count, count a date from a file. <code>grep 2017-07 seasonal/spring.csv | wc -l</code></p>
<p><code>head -n 3 seasonal/s*</code>, show all s* files first 3 rows.</p>
<ul>
<li><code>*</code>, all</li>
<li><code>?</code>, single word</li>
<li><code>[...]</code> matches any one of the characters inside the square brackets, <code>201[78].txt</code> matches <code>2017.txt</code> or <code>2018.txt</code>, but not <code>2016.txt</code></li>
<li><code>{...}</code> matches any of the comma-separated patterns inside the curly brackets, so <code>{*.txt, *.csv}</code> matches any file whose name ends with <code>.txt</code> or <code>.csv</code>, but not files whose names end with <code>.pdf</code>.</li>
</ul>
<p><code>sort</code>, <code>-n</code>: sort numerically, <code>-r</code>: reverse, <code>-b</code>: ignore leading blanks, <code>-f</code>: be case-insensitive</p>
<p><code>uniq</code>, remove <strong>adjacent</strong> duplicated lines .</p>
<p><code>wc -l seasonal/*.csv</code>, Print line numbers for each file in folder seasonal</p>
<p><code>wc -l seasonal/*.csv | grep -v &#39;total&#39; | sort -n | head -n 1</code>, remove rows with word ‘total’ and select first row.</p>
<h2 id="Batch-processing"><a href="#Batch-processing" class="headerlink" title="Batch processing"></a>Batch processing</h2><blockquote>
<p>How to make your own pipelines do that. Along the way, you will see how the shell uses variables to store information.</p>
</blockquote>
<p><code>set</code>: check <strong>environment variables</strong></p>
<p><code>echo</code>: print</p>
<ul>
<li><code>$User</code>, user name</li>
<li><code>$OSTYPE</code> name of the kind of operating system you are using</li>
</ul>
<p><code>training=seasonal/summer.csv</code> then <code>echo $training</code>, define a variable and print it.</p>
<p><strong>For loop:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example 1</span></span><br><span class="line"><span class="keyword">for</span> filetype <span class="keyword">in</span> gif jpg png; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$filetype</span>; <span class="keyword">done</span></span><br><span class="line"><span class="comment"># Example 2</span></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> seasonal/*.csv; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$filename</span>; <span class="keyword">done</span></span><br><span class="line"><span class="comment"># Example 3</span></span><br><span class="line">datasets=seasonal/*.csv</span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> <span class="variable">$datasets</span>; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$filename</span>; <span class="keyword">done</span></span><br><span class="line"><span class="comment"># Example 4</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> seasonal/*.csv; <span class="keyword">do</span> head -n 2 <span class="variable">$file</span> | tail -n 1; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Do not using space in file name, it will causing issue in bash.</p>
</blockquote>
<h2 id="Creating-new-tools"><a href="#Creating-new-tools" class="headerlink" title="Creating new tools"></a>Creating new tools</h2><blockquote>
<p>How to go one step further and create new commands of your own.</p>
</blockquote>
<p><strong>Edit file using <code>nano</code>:</strong></p>
<p><code>nano filename.txt</code>, edit a file</p>
<ul>
<li><code>Ctrl</code> + <code>K</code>: delete a line.</li>
<li><code>Ctrl</code> + <code>U</code>: un-delete a line.</li>
<li><code>Ctrl</code> + <code>O</code>: save the file (‘O’ stands for ‘output’). <em>You will also need to press Enter to confirm the filename!</em></li>
<li><code>Ctrl</code> + <code>X</code>: exit the editor.</li>
</ul>
<p><code>grep -h -v Tooth spring.csv summer.csv &gt; temp.csv</code>, <code>-h</code> stop it from printing filenames, <code>-v</code> printing all rows exclude Tooth</p>
<p><code>history | tail -n 3</code>, Show most recent 3 commands</p>
<p><code>$@</code>, pass filenames to scripts. <code>tail -q -n +2 $@ | wc -l</code></p>
<h2 id="Downloading-data"><a href="#Downloading-data" class="headerlink" title="Downloading data"></a>Downloading data</h2><blockquote>
<p> how to download data files from web servers via the command line</p>
</blockquote>
<p><code>curl</code>, Client for URLs.  <code>man curl</code> , check curl installation.</p>
<ul>
<li><code>curl -O url</code> save the file with it’s original name</li>
<li><code>curl -o newname.txt url</code> new file name</li>
<li>Download all 100 data file, <code>curl -O https://s3.amazonaws.com/datafile[001-100].txt</code></li>
</ul>
<p><code>Wget</code>, World Wide Web and get. better than curl when downloading multiple files recursively. <code>which wget</code>, check <code>wget</code> installation.</p>
<p><code>wget -c -b https://wittyfans.com/201812SpotifyData.zip</code></p>
<ul>
<li><code>-c</code>, resume broken download</li>
<li><code>-b</code>, go to background </li>
<li><code>wget --wait=1 -i url_list.txt</code>, # Create a mandatory 1 second pause between downloading all files in url_list.txt</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use curl, download and rename a single file from URL</span></span><br><span class="line">curl -O Spotify201812.zip -L https://assets.datacamp.com/production/repositories/4180/datasets/eb1d6a36fa3039e4e00064797e1a1600d267b135/201812SpotifyData.zip</span><br><span class="line"></span><br><span class="line"><span class="comment"># Unzip, delete, then re-name to Spotify201812.csv</span></span><br><span class="line">unzip Spotify201812.zip &amp;&amp; rm Spotify201812.zip</span><br><span class="line">mv 201812SpotifyData.csv Spotify201812.csv</span><br><span class="line"></span><br><span class="line"><span class="comment"># View url_list.txt to verify content</span></span><br><span class="line">cat url_list.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use Wget, limit the download rate to 2500 KB/s, download all files in url_list.txt</span></span><br><span class="line">wget --<span class="built_in">limit</span>-rate=2500k -i url_list.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Take a look at all files downloaded</span></span><br><span class="line">ls</span><br></pre></td></tr></table></figure>
<h2 id="CSV-Kit"><a href="#CSV-Kit" class="headerlink" title="CSV Kit"></a>CSV Kit</h2><blockquote>
<p>Using <code>csvkit</code> to convert, preview, filter and manipulate files to prepare our data for further analyses.</p>
</blockquote>
<p><code>pip install csvk</code> for install, <a href="https://csvkit.readthedocs.io/en/latest/tutorial.html" target="_blank" rel="noopener">Doc</a></p>
<h3 id="in2csv"><a href="#in2csv" class="headerlink" title="in2csv"></a>in2csv</h3><ul>
<li><p><code>in2csv -h</code>, converting files to csv.</p>
</li>
<li><p><code>in2csv SpotifyData.xlsx &gt; SpotifyData.csv</code></p>
</li>
<li><p><code>in2csv SpotifyData.xlsx --sheet &quot;Worksheet1_Popularity&quot; &gt; Spotify_Popularity.csv</code>, Only converting a sheet</p>
</li>
</ul>
<h3 id="csvlook"><a href="#csvlook" class="headerlink" title="csvlook"></a>csvlook</h3><p><code>csvlook -h</code>, data preview on the command line.</p>
<p><code>csvlook SpotifyData.csv</code></p>
<h3 id="csvsort"><a href="#csvsort" class="headerlink" title="csvsort"></a>csvsort</h3><p><code>csvsort -c 2 Spotify_Popularity.csv | csvlook</code></p>
<h3 id="csvstat"><a href="#csvstat" class="headerlink" title="csvstat"></a>csvstat</h3><p><code>csvstat Spotify_Popularity.csv</code>, summary statistics</p>
<h3 id="csvcut"><a href="#csvcut" class="headerlink" title="csvcut"></a>csvcut</h3><p><code>csvcut -n Spotify_MusicAttributes.csv</code>, Print a list of column headers in data file</p>
<p><code>csvcut -c 1,3,5 Spotify_MusicAttributes.csv</code>, Print the first column, by position</p>
<p><code>csvcut -c &quot;track_id&quot;,&quot;duration_ms&quot;,&quot;loudness&quot; Spotify_MusicAttributes.csv</code>, Print the track id, song duration, and loudness, by name </p>
<h3 id="csvgrep"><a href="#csvgrep" class="headerlink" title="csvgrep"></a>csvgrep</h3><p><code>csvgrep -c &quot;danceability&quot; -m 0.812 Spotify_MusicAttributes.csv</code>, filter row danceability by value 0.812, column name must with “”.</p>
<h3 id="csvstack"><a href="#csvstack" class="headerlink" title="csvstack"></a>csvstack</h3><p><code>csvstack</code>, merge files. </p>
<p><code>csvstack Spotify_Rank6.csv Spotify_Rank7.csv &gt; Spotify.csv</code>, merge two files to one</p>
<p><code>csvstack -g &quot;Rank6&quot;,&quot;Rank7&quot; \ Spotify_Rank6.csv Spotify_Rank7.csv &gt; Spotify_Al</code>, merge two files to one and add a source column.</p>
<h3 id="chain-commands"><a href="#chain-commands" class="headerlink" title="chain commands"></a>chain commands</h3><p><code>;</code>, links commands together and runs sequentially</p>
<p><code>&amp;&amp;</code>, links commands together, but only runs the 2nd command if the 1st succeeds</p>
<p><code>&gt;</code>, using outputs from the 1st command</p>
<p><code>|</code>, using outputs form the 1st as input to the 2nd</p>
<h3 id="sql2csv"><a href="#sql2csv" class="headerlink" title="sql2csv"></a>sql2csv</h3><p><code>sql2csv -v</code> or <code>sql2csv --verbose</code>,  printing more tracebacks and logs </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pull the entire Spotify_Popularity table and print in log</span></span><br><span class="line">sql2csv --db <span class="string">"sqlite:///SpotifyDatabase.db"</span> \</span><br><span class="line">        --query <span class="string">"SELECT * FROM Spotify_Popularity"</span></span><br></pre></td></tr></table></figure>
<h3 id="csvsql"><a href="#csvsql" class="headerlink" title="csvsql"></a>csvsql</h3><p>Manipulating data using SQL syntax (Small to medium files only) :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Reformat the output using csvlook </span></span><br><span class="line">csvsql --query <span class="string">"SELECT * FROM Spotify_MusicAttributes ORDER BY duration_ms LIMIT 1"</span> \</span><br><span class="line">	Spotify_MusicAttributes.csv | csvlook</span><br></pre></td></tr></table></figure>
<p>using bash variable:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Store SQL query as shell variable</span></span><br><span class="line">sqlquery=<span class="string">"SELECT * FROM Spotify_MusicAttributes ORDER BY duration_ms LIMIT 1"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Apply SQL query to Spotify_MusicAttributes.csv</span></span><br><span class="line">csvsql --query <span class="string">"<span class="variable">$sqlquery</span>"</span> Spotify_MusicAttributes.csv</span><br></pre></td></tr></table></figure>
<p>join two file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Store SQL query as shell variable</span></span><br><span class="line">sql_query=<span class="string">"SELECT ma.*, p.popularity FROM Spotify_MusicAttributes ma INNER JOIN Spotify_Popularity p ON ma.track_id = p.track_id"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Join 2 local csvs into a new csv using the saved SQL</span></span><br><span class="line">csvsql --query <span class="string">"<span class="variable">$sql_query</span>"</span> Spotify_MusicAttributes.csv Spotify_Popularity.csv &gt; Spotify_FullData.csv</span><br><span class="line"></span><br><span class="line"><span class="comment"># Preview newly created file</span></span><br><span class="line">csvstat Spotify_FullData.csv</span><br></pre></td></tr></table></figure>
<p>Pushing data back to database:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Store SQL for querying from SQLite database </span></span><br><span class="line">sqlquery_pull=<span class="string">"SELECT * FROM SpotifyMostRecentData"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Apply SQL to save table as local file </span></span><br><span class="line">sql2csv --db <span class="string">"sqlite:///SpotifyDatabase.db"</span> --query <span class="string">"<span class="variable">$sqlquery_pull</span>"</span> &gt; SpotifyMostRecentData.csv</span><br><span class="line"></span><br><span class="line"><span class="comment"># Store SQL for UNION of the two local CSV files</span></span><br><span class="line">sqlquery_union=<span class="string">"SELECT * FROM SpotifyMostRecentData UNION ALL SELECT * FROM Spotify201812"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Apply SQL to union the two local CSV files and save as local file</span></span><br><span class="line">csvsql 	--query <span class="string">"<span class="variable">$sqlquery_union</span>"</span> SpotifyMostRecentData.csv Spotify201812.csv &gt; UnionedSpotifyData.csv</span><br><span class="line"></span><br><span class="line"><span class="comment"># Push UnionedSpotifyData.csv to database as a new table</span></span><br><span class="line">csvsql --db <span class="string">"sqlite:///SpotifyDatabase.db"</span> --insert UnionedSpotifyData.csv</span><br></pre></td></tr></table></figure>
<h1 id="Bash-Script"><a href="#Bash-Script" class="headerlink" title="Bash Script"></a>Bash Script</h1><h2 id="Stream-editor"><a href="#Stream-editor" class="headerlink" title="Stream editor"></a>Stream editor</h2><p><code>sed</code>: stream editor.</p>
<p><code>cat soccer_scores.csv | sed &#39;s/Cherno/Cherno City/g&#39; &gt; soccer_scores_edited.csv</code> : replace word <code>Cherno</code> to  <code>herno City</code> then save it to a new file, for more, check <a href="https://coolshell.cn/articles/9104.html" target="_blank" rel="noopener">this</a>.</p>
<h2 id="Argument"><a href="#Argument" class="headerlink" title="Argument"></a>Argument</h2><p> <code>$1</code> or <code>$2</code> in bash script file, receive ARGV in bash scripts. <code>$@</code> , <code>$*</code> means get ARGV list, <code>$#</code> means get ARGV length. <code>cat hire_data/*.csv | grep &quot;$1&quot; &gt; &quot;$1&quot;.csv</code>: take in a city (an argument) as a variable, filter all the files by this city and output to a new CSV with the city name.</p>
<h2 id="Quotes"><a href="#Quotes" class="headerlink" title="Quotes"></a>Quotes</h2><p>Single,double,backticks. </p>
<ul>
<li><p>Single quotes (‘sometext’) = Shell interprets what is between literally</p>
</li>
<li><p>Double quotes (“sometext”) = Shell interpret literally except using $ and backticks</p>
</li>
<li><p>Backticks (`sometext`) = Shell runs the command and captures STDOUT back into a variable</p>
</li>
</ul>
<h2 id="Numeric-variables"><a href="#Numeric-variables" class="headerlink" title="Numeric variables"></a>Numeric variables</h2><p>In bash, Type <code>&gt;&gt;&gt; 1 + 5</code> will get error. instead, you need type <code>expr 1 + 5</code>.  <code>expr</code>  is utility program just like <code>cat</code> and <code>grep</code>. but <code>expr</code> cannot natively handle decimal places. <code>expr 1 + 2.5</code> will get <code>not a decimal nuber error</code>.</p>
<p>Introduce <code>bc</code> (basic calculator), a useful command-line program. using <code>bc</code> without opening the calculator:</p>
<p><code>echo &quot;5+7.5&quot; | bc</code> , <code>bc</code> has a <code>scale</code> argument for how many decimal places: <code>echo &quot;scale=3; 10 /3 | bc&quot;</code>, <code>;</code> is to separate lines in terminal.</p>
<h2 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h2><h3 id="Normal-array"><a href="#Normal-array" class="headerlink" title="Normal array"></a>Normal array</h3><p>Create array: <code>capital_cities=(&quot;Sydney&quot; &quot;New York&quot; &quot;Paris&quot;)</code></p>
<p>Add element: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create a normal array with the mentioned elements using the declare method</span></span><br><span class="line"><span class="built_in">declare</span> -a capital_cities</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add (append) the elements</span></span><br><span class="line">capital_cities+=(<span class="string">"Sydney"</span>)</span><br><span class="line">capital_cities+=(<span class="string">"New York"</span>)</span><br><span class="line">capital_cities+=(<span class="string">"Paris"</span>)</span><br></pre></td></tr></table></figure>
<p>Get all element and length of array:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The array has been created for you</span></span><br><span class="line">capital_cities=(<span class="string">"Sydney"</span> <span class="string">"New York"</span> <span class="string">"Paris"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print out the entire array</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;capital_cities[@]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Print out the array length</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#capital_cities[@]&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Associative-arrays"><a href="#Associative-arrays" class="headerlink" title="Associative arrays"></a>Associative arrays</h3><blockquote>
<p>Like dictionary in python.</p>
</blockquote>
<p>Create:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create empty associative array</span></span><br><span class="line"><span class="built_in">declare</span> -A model_metrics</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add the key-value pairs</span></span><br><span class="line">model_metrics[model_accuracy]=98</span><br><span class="line">model_metrics[model_name]=<span class="string">"knn"</span></span><br><span class="line">model_metrics[model_f1]=0.82</span><br></pre></td></tr></table></figure>
<p>Create in one line:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># An associative array has been created for you</span></span><br><span class="line"><span class="built_in">declare</span> -A model_metrics=([model_accuracy]=98 [model_name]=<span class="string">"knn"</span> [model_f1]=0.82)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print out just the keys</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;____model_metrics[____]&#125;</span></span><br></pre></td></tr></table></figure>
<p>Example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create variables from the temperature data files</span></span><br><span class="line">temp_b=<span class="string">"<span class="variable">$(cat temps/region_B)</span>"</span></span><br><span class="line">temp_c=<span class="string">"<span class="variable">$(cat temps/region_C)</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create an array with these variables as elements</span></span><br><span class="line">region_temps=(<span class="variable">$temp_b</span> <span class="variable">$temp_c</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Call an external program to get average temperature</span></span><br><span class="line">average_temp=$(<span class="built_in">echo</span> <span class="string">"scale=2; (<span class="variable">$&#123;region_temps[0]&#125;</span> + <span class="variable">$&#123;region_temps[1]&#125;</span>) / 2"</span> | bc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Append to array</span></span><br><span class="line">region_temps+=(<span class="variable">$average_temp</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print out the whole array</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;region_temps[@]&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Control-Statements"><a href="#Control-Statements" class="headerlink" title="Control Statements"></a>Control Statements</h2><h3 id="IF-statements"><a href="#IF-statements" class="headerlink" title="IF statements"></a>IF statements</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ condition1 ] &amp;&amp; [ condition2 ]; <span class="keyword">then</span></span><br><span class="line">	<span class="comment"># some code</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="comment"># some code</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>Move files based on content:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Extract Accuracy from first ARGV element</span></span><br><span class="line">accuracy=$(grep Accuracy <span class="variable">$1</span> | sed <span class="string">'s/.* //'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Conditionally move into good_models folder</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$accuracy</span> -ge 90 ]; <span class="keyword">then</span></span><br><span class="line">    mv <span class="variable">$1</span> ./good_models</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Conditionally move into bad_models folder</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$accuracy</span> -lt 90 ]; <span class="keyword">then</span></span><br><span class="line">    mv <span class="variable">$1</span> ./bad_models</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Normal flags</span></span><br><span class="line">-eq =</span><br><span class="line">-ne !=</span><br><span class="line">-lt &lt;</span><br><span class="line">-le &lt;=</span><br><span class="line">-gt &gt;</span><br><span class="line">-ge &gt;=</span><br><span class="line"></span><br><span class="line"><span class="comment"># File related flags</span></span><br><span class="line">-e <span class="keyword">if</span> the file exists</span><br><span class="line">-s <span class="keyword">if</span> the file exists and has size greater than zero</span><br><span class="line">-r <span class="keyword">if</span> the file exists and is readable</span><br><span class="line">-w <span class="keyword">if</span> the file exists and is writable</span><br><span class="line"></span><br><span class="line"><span class="comment">## And and OR</span></span><br><span class="line">&amp;&amp; <span class="keyword">for</span> and</span><br><span class="line">|| <span class="keyword">for</span> or</span><br></pre></td></tr></table></figure>
<h2 id="For-loops"><a href="#For-loops" class="headerlink" title="For loops"></a>For loops</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use a FOR loop on files in directory</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> inherited_folder/*.R</span><br><span class="line"><span class="keyword">do</span>  </span><br><span class="line">    <span class="comment"># Echo out each file</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$file</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Move python file to to_keep if it using random forest class fier</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> robs_files/*.py</span><br><span class="line"><span class="keyword">do</span>  </span><br><span class="line">    <span class="comment"># Create IF statement using grep</span></span><br><span class="line">    <span class="keyword">if</span> grep -q <span class="string">'RandomForestClassifier'</span> <span class="variable">$file</span> ; <span class="keyword">then</span></span><br><span class="line">        <span class="comment"># Move wanted files to to_keep/ folder</span></span><br><span class="line">        mv <span class="variable">$file</span> to_keep/</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h2 id="Case"><a href="#Case" class="headerlink" title="Case"></a>Case</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create a CASE statement matching the first ARGV element</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">  <span class="comment"># Match on all weekdays</span></span><br><span class="line">  Monday|Tuesday|Wednesday|Thursday|Friday)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"It is a Weekday!"</span>;;</span><br><span class="line">  <span class="comment"># Match on all weekend days</span></span><br><span class="line">  Saturday|Sunday)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"It is a Weekend!"</span>;;</span><br><span class="line">  <span class="comment"># Create a default</span></span><br><span class="line">  *) </span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Not a day!"</span>;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<h2 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> function_name &#123;    </span><br><span class="line">	<span class="comment">#function_code    </span></span><br><span class="line">	<span class="built_in">return</span> <span class="comment">#something</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">print_hello</span></span> () &#123;    </span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Hello world!"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print_hello</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Scope: All variables in Bash are global by default!</strong>Using <code>local val</code> to restrict variable scope.</p>
</blockquote>
<p>To get data out from function:</p>
<ol>
<li>Assign to a global variable</li>
<li><code>echo</code> what we want back in last line and capture using shell-within-shell</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> convert &#123;</span><br><span class="line">	<span class="built_in">echo</span> $(<span class="built_in">echo</span> <span class="variable">$1</span>)</span><br><span class="line">&#125;</span><br><span class="line">converted = $(convert 30)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create a function with a local base variable</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">sum_array</span></span> () &#123;</span><br><span class="line">  <span class="built_in">local</span> sum=0</span><br><span class="line">  <span class="comment"># Loop through, adding to base variable</span></span><br><span class="line">  <span class="keyword">for</span> number <span class="keyword">in</span> <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    sum=$(<span class="built_in">echo</span> <span class="string">"<span class="variable">$sum</span> + <span class="variable">$number</span>"</span> | bc)</span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="comment"># Echo back the result</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$sum</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment"># Call function with array</span></span><br><span class="line">test_array=(14 12 23.5 16 19.34)</span><br><span class="line">total=$(sum_array <span class="string">"<span class="variable">$&#123;test_array[@]&#125;</span>"</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"The total sum of the test array is <span class="variable">$total</span>"</span></span><br></pre></td></tr></table></figure>
<h1 id="Python-script-on-bash"><a href="#Python-script-on-bash" class="headerlink" title="Python script on bash"></a>Python script on bash</h1><blockquote>
<p>Scheduling a job with crontab</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Preview both Python script and requirements text file</span></span><br><span class="line">cat create_model.py</span><br><span class="line">cat requirements.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pip install Python dependencies in requirements file</span></span><br><span class="line">pip install -r requirements.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run Python script on command line</span></span><br><span class="line">python create_model.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add CRON job that runs create_model.py every minute</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"* * * * * python create_model.py"</span> | crontab</span><br><span class="line"></span><br><span class="line"><span class="comment"># Verify that the CRON job has been scheduled via CRONTAB</span></span><br><span class="line">crontab -l</span><br></pre></td></tr></table></figure>
<h1 id="Cron"><a href="#Cron" class="headerlink" title="Cron"></a>Cron</h1><ul>
<li>crontab -l, list the crons</li>
</ul>
<blockquote>
<p>set your editor to nano, default vim</p>
</blockquote>
<ul>
<li><p>export EDITOR=/user/bin/nano</p>
</li>
<li><p>crontab -e, open editor</p>
<ul>
<li>press i to input</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Algorhythm for schuel you task with time</span><br><span class="line"></span><br><span class="line"># ┌───────────── minute (0 - 59)</span><br><span class="line"># │ ┌───────────── hour (0 - 23)</span><br><span class="line"># │ │ ┌───────────── day of month (1 - 31)</span><br><span class="line"># │ │ │ ┌───────────── month (1 - 12)</span><br><span class="line"># │ │ │ │ ┌───────────── day of week (0 - 6) (Sunday to Saturday;</span><br><span class="line"># │ │ │ │ │                                       7 is also Sunday on some systems)</span><br><span class="line"># │ │ │ │ │</span><br><span class="line"># │ │ │ │ │</span><br><span class="line"># * * * * *  command_to_execute</span><br></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/uploads/wechat-reward-image.png" alt="Scott Zhang WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
    </div>
  </div>


      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/bash/" rel="tag"># bash</a>
          
            <a href="/tags/linux/" rel="tag"># linux</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/coding/机器学习相关概念解读p1.html" rel="next" title="机器学习相关概念解读p1">
                <i class="fa fa-chevron-left"></i> 机器学习相关概念解读p1
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.png"
               alt="Scott Zhang" />
          <p class="site-author-name" itemprop="name">Scott Zhang</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">67</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">74</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/wittyfans" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://music.163.com/#/user/event?id=5842815" target="_blank" title="Netease Music">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Netease Music
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.instagram.com/wittyfans/" target="_blank" title="Instagram">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Instagram
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/wittyfans" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Basic"><span class="nav-number">1.</span> <span class="nav-text">Basic</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Find-files"><span class="nav-number">2.</span> <span class="nav-text">Find files</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#by-name"><span class="nav-number">2.1.</span> <span class="nav-text">by name</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#by-time"><span class="nav-number">2.2.</span> <span class="nav-text">by time</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#by-size"><span class="nav-number">2.3.</span> <span class="nav-text">by size</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#by-permission"><span class="nav-number">2.4.</span> <span class="nav-text">by permission</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Grep"><span class="nav-number">3.</span> <span class="nav-text">Grep</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Grep-single-file"><span class="nav-number">3.1.</span> <span class="nav-text">Grep single file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Grep-multi-file"><span class="nav-number">3.2.</span> <span class="nav-text">Grep multi file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Grep-command-history"><span class="nav-number">3.3.</span> <span class="nav-text">Grep command history</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Grep-rgx"><span class="nav-number">3.4.</span> <span class="nav-text">Grep rgx</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#cURL"><span class="nav-number">4.</span> <span class="nav-text">cURL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Requests"><span class="nav-number">4.1.</span> <span class="nav-text">Requests</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Verify"><span class="nav-number">4.2.</span> <span class="nav-text">Verify</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Download"><span class="nav-number">4.3.</span> <span class="nav-text">Download</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#rsync"><span class="nav-number">5.</span> <span class="nav-text">rsync</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Install"><span class="nav-number">5.1.</span> <span class="nav-text">Install</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Use"><span class="nav-number">5.2.</span> <span class="nav-text">Use</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Check-chage-before-run"><span class="nav-number">5.3.</span> <span class="nav-text">Check chage before run</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Source-folder-has-new-file"><span class="nav-number">5.4.</span> <span class="nav-text">Source_folder has new file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Do-it-in-local-and-host"><span class="nav-number">5.5.</span> <span class="nav-text">Do it in local and host</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Manipulating-data"><span class="nav-number">6.</span> <span class="nav-text">Manipulating data</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Combining-tools"><span class="nav-number">6.1.</span> <span class="nav-text">Combining tools</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Batch-processing"><span class="nav-number">6.2.</span> <span class="nav-text">Batch processing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Creating-new-tools"><span class="nav-number">6.3.</span> <span class="nav-text">Creating new tools</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Downloading-data"><span class="nav-number">6.4.</span> <span class="nav-text">Downloading data</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CSV-Kit"><span class="nav-number">6.5.</span> <span class="nav-text">CSV Kit</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#in2csv"><span class="nav-number">6.5.1.</span> <span class="nav-text">in2csv</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#csvlook"><span class="nav-number">6.5.2.</span> <span class="nav-text">csvlook</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#csvsort"><span class="nav-number">6.5.3.</span> <span class="nav-text">csvsort</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#csvstat"><span class="nav-number">6.5.4.</span> <span class="nav-text">csvstat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#csvcut"><span class="nav-number">6.5.5.</span> <span class="nav-text">csvcut</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#csvgrep"><span class="nav-number">6.5.6.</span> <span class="nav-text">csvgrep</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#csvstack"><span class="nav-number">6.5.7.</span> <span class="nav-text">csvstack</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#chain-commands"><span class="nav-number">6.5.8.</span> <span class="nav-text">chain commands</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sql2csv"><span class="nav-number">6.5.9.</span> <span class="nav-text">sql2csv</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#csvsql"><span class="nav-number">6.5.10.</span> <span class="nav-text">csvsql</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Bash-Script"><span class="nav-number">7.</span> <span class="nav-text">Bash Script</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Stream-editor"><span class="nav-number">7.1.</span> <span class="nav-text">Stream editor</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Argument"><span class="nav-number">7.2.</span> <span class="nav-text">Argument</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Quotes"><span class="nav-number">7.3.</span> <span class="nav-text">Quotes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Numeric-variables"><span class="nav-number">7.4.</span> <span class="nav-text">Numeric variables</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Array"><span class="nav-number">7.5.</span> <span class="nav-text">Array</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Normal-array"><span class="nav-number">7.5.1.</span> <span class="nav-text">Normal array</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Associative-arrays"><span class="nav-number">7.5.2.</span> <span class="nav-text">Associative arrays</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Control-Statements"><span class="nav-number">7.6.</span> <span class="nav-text">Control Statements</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#IF-statements"><span class="nav-number">7.6.1.</span> <span class="nav-text">IF statements</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#For-loops"><span class="nav-number">7.7.</span> <span class="nav-text">For loops</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Case"><span class="nav-number">7.8.</span> <span class="nav-text">Case</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Function"><span class="nav-number">7.9.</span> <span class="nav-text">Function</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Python-script-on-bash"><span class="nav-number">8.</span> <span class="nav-text">Python script on bash</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Cron"><span class="nav-number">9.</span> <span class="nav-text">Cron</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Scott Zhang</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("7sScl0n1AlEtVDaUHuXzxPqc-gzGzoHsz", "qKXpoqGbK1sdFYMiik7Evuan");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
